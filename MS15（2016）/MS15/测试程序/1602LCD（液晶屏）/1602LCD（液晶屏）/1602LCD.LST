C51 COMPILER V9.01   1602LCD                                                               07/15/2013 12:51:13 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 1602LCD
OBJECT MODULE PLACED IN 1602LCD.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 1602LCD.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <STC12C5A60S2.H>
   2          #include <intrins.H>
   3          typedef unsigned char uchar;//uchar代替unsigned char
   4          typedef unsigned int  uint;     //uint代替unsigned int
   5          
   6          sbit RS = P2^5;//寄存器选择，1为数据寄存器，0为指令寄存器
   7          sbit RW = P2^6;//读写信号，1为读操作，0为写操作
   8          sbit EN = P2^7;//使能，写操作时下降沿有效，读操作时高电平有效
   9          
  10          uchar code dis1[]={"welcome!"};
  11          uchar code dis2[]={"hiold.taobao.com"};
  12          
  13          
  14          
  15          /*********************************************************************************************************
             -***
  16          *************************************延时函数*************************************************************
             -***
  17          **********************************************************************************************************
             -**/
  18          
  19          void Delayms(uchar ms)          //@11.0592MHz
  20          {
  21   1              uchar i, j;
  22   1      
  23   1              while(ms--)
  24   1                      {
  25   2                              i = 11;
  26   2                              j = 190;
  27   2                              do
  28   2                                      {
  29   3                                              while (--j);
  30   3                                      }
  31   2                               while (--i);
  32   2                      }
  33   1      }
  34          
  35          void Delayus(uchar us)          //@11.0592MHz
  36          {
  37   1              uchar i;
  38   1      
  39   1              while(us--)
  40   1                      {
  41   2                              _nop_();
  42   2                              _nop_();
  43   2                              i = 24;
  44   2                              while (--i);
  45   2                      }
  46   1      }
  47          
  48          /*********************************************************************************************************
             -***
  49          *************************************读忙函数*************************************************************
             -***
  50          **********************************************************************************************************
C51 COMPILER V9.01   1602LCD                                                               07/15/2013 12:51:13 PAGE 2   

             -**/
  51          
  52          bit busy()
  53          {
  54   1              bit mang;
  55   1              RS=0;
  56   1              RW=1;
  57   1              EN=1;
  58   1              Delayus(2);
  59   1              mang=(bit)(P0&0x80);//读取P0最高位的值
  60   1              EN=0;
  61   1              return mang;//返回读到的忙状态
  62   1      }
  63          
  64          /*********************************************************************************************************
             -***
  65          *************************************写指令函数***********************************************************
             -***
  66          **********************************************************************************************************
             -**/
  67          
  68          void WCMD(uchar cmd)
  69          {
  70   1              while(busy());//查忙
  71   1              RS=0;
  72   1              RW=0;
  73   1              EN=0;
  74   1              P0=cmd;//将指令赋给P0
  75   1          Delayus(1);//摸拟产生一个脉冲
  76   1              EN=1;
  77   1          Delayus(1);
  78   1              EN=0;
  79   1      }
  80          
  81          /*********************************************************************************************************
             -***
  82          *************************************写数据函数***********************************************************
             -***
  83          **********************************************************************************************************
             -**/
  84          
  85          void WDAT(uchar dat)
  86          {
  87   1              while(busy());//查忙
  88   1              RS=1;
  89   1              RW=0;
  90   1              EN=0;
  91   1              P0=dat;//将数据赋给P0
  92   1              Delayus(1);//摸拟产生一个脉冲
  93   1              EN=1;
  94   1              Delayus(1);
  95   1              EN=0;
  96   1      }
  97          
  98          /*********************************************************************************************************
             -***
  99          *************************************初始化函数***********************************************************
             -***
 100          **********************************************************************************************************
             -**/
 101          
 102          void init()
C51 COMPILER V9.01   1602LCD                                                               07/15/2013 12:51:13 PAGE 3   

 103          {
 104   1              WCMD(0X38);//8位数据，显示16X2，5X7点阵
 105   1              Delayms(1);
 106   1              WCMD(0X0C);//开显示，关光标
 107   1              Delayms(1);
 108   1              WCMD(0x06);//移动光标
 109   1              Delayms(1);
 110   1              WCMD(0X01);//清屏
 111   1              Delayms(10);
 112   1      }
 113          
 114          /*********************************************************************************************************
             -***
 115          *************************************主函数***************************************************************
             -***
 116          **********************************************************************************************************
             -**/
 117          
 118          void main()
 119          {
 120   1              uchar i=0;
 121   1              init();
 122   1          WCMD(0X80+0X04);//设置第一行地址，起始地址为0X80，第一行第4位的地址为0X04
 123   1              while(dis1[i]!=0)//显示第一行的内容
 124   1                      {
 125   2                              WDAT(dis1[i]);
 126   2                          i++;
 127   2                      }
 128   1              WCMD(0X80+0X40);//设置第二行地址，起始地址为0X80，第一行第1位的地址为0X40
 129   1              i=0;
 130   1              while(dis2[i]!=0)//显示第二行的内容
 131   1                      {
 132   2                              WDAT(dis2[i]);
 133   2                              i++;
 134   2                      }
 135   1              while(1);
 136   1      }
 137          
 138          
 139          
 140          
 141          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    187    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
