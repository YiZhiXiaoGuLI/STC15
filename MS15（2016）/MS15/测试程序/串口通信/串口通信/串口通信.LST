C51 COMPILER V9.01   串口通信                                                              03/01/2014 16:03:52 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 串口通信
OBJECT MODULE PLACED IN 串口通信.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 串口通信.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************************************
             -*/
   2          
   3          /******************************* 串口通讯例程（参考宏晶官方例程）*****************************************
             -*/
   4          /*******************************        hiold.taobao.com       *******************************************
             -*/
   5          
   6          /*********************************************************************************************************
             -*/
   7          
   8          
   9          #include "reg51.h"
  10          #include "intrins.h"
  11          
  12          typedef unsigned char uchar;
  13          typedef unsigned int uint;
  14          
  15          #define FOSC 11059200L      //晶振频率
  16          #define BAUD 115200           //波特率
  17          
  18          sfr AUXR  = 0x8e;               //辅助寄存器
  19          
  20          bit    busy,flag=0;
  21          uchar  Redata;
  22          uint   i=0,j=0;
  23          
  24          
  25          void SendData(uchar dat);
  26          void SendString(uchar *S);
  27          
  28          void main()
  29          {
  30   1              
  31   1          AUXR = 0x40;                //定时器1为1T模式
  32   1          SCON = 0x50;
  33   1          TMOD = 0x20;            //定时器1为8位自动装载模式
  34   1          TH1 = TL1 =(256 - (FOSC/32/BAUD));  //自动装载值
  35   1          TR1 = 1;                //打开定时器1
  36   1          ES = 1;                 //开串口中断
  37   1          EA = 1;                 //开总中断          
  38   1              SendString("这是从单片机发来的数据，现在你可以给单片机发送数据"); //向PC发送一条字符串
  39   1                                              
  40   1              while(1)
  41   1                      {
  42   2                              if(flag)
  43   2                                      {
  44   3                                              SBUF=Redata;
  45   3                                              flag=0;                         
  46   3                                      }       
  47   2                      }       
  48   1      }
  49          
  50          /*********************************************************************************************************
  51          *************************************串口中断程序*********************************************************
C51 COMPILER V9.01   串口通信                                                              03/01/2014 16:03:52 PAGE 2   

  52          *********************************************************************************************************/
  53          void Uart_Isr() interrupt 4 using 1
  54          {
  55   1          if (RI)
  56   1          {
  57   2              RI = 0;             //Clear receive interrupt flag
  58   2              Redata =SBUF;          //P0 show UART data
  59   2                      flag=1;
  60   2           }
  61   1      
  62   1          if (TI)
  63   1          {
  64   2              TI = 0;             //Clear transmit interrupt flag
  65   2              busy = 0;           //Clear transmit busy flag
  66   2          }
  67   1      }
  68          
  69          /*********************************************************************************************************
  70          *************************************发送一个字节*********************************************************
  71          *********************************************************************************************************/
  72          void SendData(uchar dat)
  73          {
  74   1          while (busy);           //等待前一字节发送完成
  75   1          busy = 1;
  76   1          SBUF = dat;             //送数据到串口缓冲区
  77   1      }
  78          
  79          
  80          /*********************************************************************************************************
  81          *************************************字符串发送程序*******************************************************
  82          *********************************************************************************************************/
  83          void SendString(uchar *s)
  84          {
  85   1          while (*s)              //检查是否字符串结尾
  86   1          {
  87   2              SendData(*s++);     //发送当前数据，获取下一数据
  88   2          }
  89   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    103    ----
   CONSTANT SIZE    =     51    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
