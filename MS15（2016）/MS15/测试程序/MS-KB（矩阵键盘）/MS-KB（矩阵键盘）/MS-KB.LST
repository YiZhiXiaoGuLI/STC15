C51 COMPILER V9.01   MS_KB                                                                 07/01/2013 11:34:54 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MS_KB
OBJECT MODULE PLACED IN MS-KB.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE MS-KB.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************************************
             -*/
   2          
   3          /*******************************        矩阵键盘MS-KB例程      *******************************************
             -*/
   4          /*******************************        hiold.taobao.com       *******************************************
             -*/
   5          
   6          /*********************************************************************************************************
             -*/
   7          
   8          
   9          #include <STC12C5A60S2.H>
  10          #define KeyPort P0//键盘接口定义
  11          #define LEDPortL P1//低位LED显示端口定义
  12          #define LEDPortH P3 //高位LED显示端口定义
  13          unsigned char Vx,Vy,Vv;//Vx代表行值，Vy代表列值,Vv代表键值
  14          unsigned char code LED[8]={0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F};//LED显示数组
  15          
  16          
  17          /*********************************************************************************************************
             -*/
  18          /***************************************  延时子程序  ****************************************************
             -*/
  19          /*********************************************************************************************************
             -*/
  20          void Delay20ms()
  21          {
  22   1              unsigned char i, j, k;
  23   1      
  24   1              i = 1;
  25   1              j = 216;
  26   1              k = 35;
  27   1              do
  28   1              {
  29   2                      do
  30   2                      {
  31   3                              while (--k);
  32   3                      } while (--j);
  33   2              } while (--i);
  34   1      }
  35          
  36          
  37          /*********************************************************************************************************
             -*/
  38          /***************************************  扫描子程序  ****************************************************
             -*/
  39          /*********************************************************************************************************
             -*/
  40          void SCANS()
  41          {
  42   1              KeyPort=0x0F;// 例为低，用于判断行值
  43   1              if(KeyPort!=0x0F)//如果有按键按下，端口的值就不会等于0x0F
  44   1                      {
  45   2                              switch(KeyPort) //获取行值
C51 COMPILER V9.01   MS_KB                                                                 07/01/2013 11:34:54 PAGE 2   

  46   2                                      {
  47   3                                              case 0x0E:{Vx=1;}break;
  48   3                                              case 0x0D:{Vx=2;}break;
  49   3                                              case 0x0B:{Vx=3;}break;
  50   3                                              case 0x07:{Vx=4;}break;
  51   3                                              default:{Vx=0;}  break;
  52   3                                      }
  53   2                              if(Vx!=0)//如果行值不为0，说明读到了正确的行值
  54   2                                      {
  55   3                                              Delay20ms();//延时消抖
  56   3                                              KeyPort=0xF0;//行为低，用于判断例值
  57   3                                              switch(KeyPort)//获取列值
  58   3                                                      {
  59   4                                                              case 0xE0:{Vy=1;}break;
  60   4                                                              case 0xD0:{Vy=2;}break;
  61   4                                                              case 0xB0:{Vy=3;}break;
  62   4                                                              case 0x70:{Vy=4;}break;
  63   4                                                              default:{Vx=0;}  break;
  64   4                                                      }
  65   3                                      }
  66   2                      }
  67   1      }
  68          
  69          
  70          /*********************************************************************************************************
             -*/
  71          /***************************************  主程序  ********************************************************
             -*/
  72          /*********************************************************************************************************
             -*/
  73          void main()
  74          {
  75   1              while(1)
  76   1                      {
  77   2                              SCANS();//扫描键值
  78   2                              if(Vx!=0)//如果Vx不等于0，说明获取键值成功
  79   2                                      {
  80   3                                              Vv=Vx*4-Vy+1;//根据行列值，计算出键值
  81   3                                              if(Vv<9)//利用两组端口的LED显示键值
  82   3                                                      {
  83   4                                                              LEDPortL=LED[Vv-1];
  84   4                                                      }
  85   3                                              else
  86   3                                                      {
  87   4                                                              LEDPortH=LED[Vv-9];
  88   4                                                      }
  89   3                                      }
  90   2                              else//没有按健按下时，关闭健值显示
  91   2                              {
  92   3                                      LEDPortL=0XFF;
  93   3                                      LEDPortH=0XFF;
  94   3                              }
  95   2                      }
  96   1      }
  97                  
  98          
  99          
 100          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    160    ----
C51 COMPILER V9.01   MS_KB                                                                 07/01/2013 11:34:54 PAGE 3   

   CONSTANT SIZE    =      8    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
