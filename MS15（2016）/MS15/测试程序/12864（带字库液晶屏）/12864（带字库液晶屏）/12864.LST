C51 COMPILER V9.01   12864                                                                 07/15/2013 12:52:13 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 12864
OBJECT MODULE PLACED IN 12864.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 12864.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <STC12C5A60S2.H>
   2          #include <intrins.H>
   3          typedef unsigned char uchar;//uchar代替unsigned char
   4          typedef unsigned int  uint;     //uint代替unsigned int
   5          
   6          sbit RS = P2^5;//寄存器选择，1为数据寄存器，0为指令寄存器
   7          sbit RW = P2^6;//读写信号，1为读操作，0为写操作
   8          sbit EN = P2^7;//使能，写操作时下降沿有效，读操作时高电平有效
   9          sbit PSB= P2^3;//并串行选择
  10          sbit RST= P2^4;//复位
  11          
  12          uchar code dis1[]={"    红欧电子    "};
  13          uchar code dis2[]={"祝您网上购物愉快"};
  14          uchar code dis3[]={"hiold.taobao.com"};
  15          uchar code dis4[]={"  旺旺ID：hiold "};
  16          
  17          
  18          
  19          /*********************************************************************************************************
             -***
  20          *************************************延时函数*************************************************************
             -***
  21          **********************************************************************************************************
             -**/
  22          
  23          void Delayms(uchar ms)          //@11.0592MHz
  24          {
  25   1              uchar i, j;
  26   1      
  27   1              while(ms--)
  28   1                      {
  29   2                              i = 11;
  30   2                              j = 190;
  31   2                              do
  32   2                                      {
  33   3                                              while (--j);
  34   3                                      }
  35   2                               while (--i);
  36   2                      }
  37   1      }
  38          
  39          void Delayus(uchar us)          //@11.0592MHz
  40          {
  41   1              uchar i;
  42   1      
  43   1              while(us--)
  44   1                      {
  45   2                              _nop_();
  46   2                              _nop_();
  47   2                              i = 24;
  48   2                              while (--i);
  49   2                      }
  50   1      }
  51          
  52          /*********************************************************************************************************
C51 COMPILER V9.01   12864                                                                 07/15/2013 12:52:13 PAGE 2   

             -***
  53          *************************************读忙函数*************************************************************
             -***
  54          **********************************************************************************************************
             -**/
  55          
  56          bit busy()
  57          {
  58   1              bit mang;
  59   1              RS=0;
  60   1              RW=1;
  61   1              EN=1;
  62   1              Delayus(2);
  63   1              mang=(bit)(P0&0x80);//读取P0最高位的值
  64   1              EN=0;
  65   1              return mang;//返回读到的忙状态
  66   1      }
  67          
  68          /*********************************************************************************************************
             -***
  69          *************************************写指令函数***********************************************************
             -***
  70          **********************************************************************************************************
             -**/
  71          
  72          void WCMD(uchar cmd)
  73          {
  74   1              while(busy());//查忙
  75   1              RS=0;
  76   1              RW=0;
  77   1              EN=0;
  78   1              P0=cmd;//将指令赋给P0
  79   1          Delayus(1);//摸拟产生一个脉冲
  80   1              EN=1;
  81   1          Delayus(1);
  82   1              EN=0;
  83   1      }
  84          
  85          /*********************************************************************************************************
             -***
  86          *************************************写数据函数***********************************************************
             -***
  87          **********************************************************************************************************
             -**/
  88          
  89          void WDAT(uchar dat)
  90          {
  91   1              while(busy());//查忙
  92   1              RS=1;
  93   1              RW=0;
  94   1              EN=0;
  95   1              P0=dat;//将数据赋给P0
  96   1              Delayus(1);//摸拟产生一个脉冲
  97   1              EN=1;
  98   1              Delayus(1);
  99   1              EN=0;
 100   1      }
 101          
 102          /*********************************************************************************************************
             -***
 103          *************************************初始化函数***********************************************************
             -***
C51 COMPILER V9.01   12864                                                                 07/15/2013 12:52:13 PAGE 3   

 104          **********************************************************************************************************
             -**/
 105          
 106          void init()
 107          {
 108   1              PSB=1;//并行方式
 109   1              RST=0;//复位
 110   1              Delayms(1);
 111   1              RST=1;
 112   1              WCMD(0X34);//扩充指令操作
 113   1              Delayms(1);
 114   1              WCMD(0X30);//基本指令操作
 115   1              Delayms(1);
 116   1              WCMD(0x0C);//开显示，关光标
 117   1              Delayms(1);
 118   1              WCMD(0X01);//清屏
 119   1              Delayms(10);
 120   1      }
 121          
 122          /*********************************************************************************************************
             -***
 123          *************************************主函数***************************************************************
             -**
 124          **********************************************************************************************************
             -**/
 125          
 126          void main()
 127          {
 128   1              uchar i;
 129   1              init();
 130   1          WCMD(0X80); //设置第一行地址
 131   1              for(i=0;i<16;i++)//显示第一行内容
 132   1                      {
 133   2                              WDAT(dis1[i]);
 134   2                          Delayms(10);
 135   2                      }
 136   1              WCMD(0X90);//设置第二行地址
 137   1              for(i=0;i<16;i++)//显示第二行内容
 138   1                      {
 139   2                              WDAT(dis2[i]);
 140   2                              Delayms(10);
 141   2                      }
 142   1              WCMD(0X88);//设置第三行地址
 143   1              for(i=0;i<16;i++)//显示第三行内容
 144   1                      {
 145   2                              WDAT(dis3[i]);
 146   2                              Delayms(10);
 147   2                      }
 148   1              WCMD(0X98);//设置第四行地址
 149   1              for(i=0;i<16;i++)//显示第4行内容
 150   1                      {
 151   2                              WDAT(dis4[i]);
 152   2                              Delayms(10);
 153   2                      }
 154   1      
 155   1              while(1);
 156   1      }
 157          
 158          
 159          
 160          
 161          
C51 COMPILER V9.01   12864                                                                 07/15/2013 12:52:13 PAGE 4   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    253    ----
   CONSTANT SIZE    =     68    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
