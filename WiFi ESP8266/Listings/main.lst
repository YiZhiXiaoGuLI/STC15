C51 COMPILER V9.56.0.0   MAIN                                                              07/26/2017 22:18:44 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND 
                    -PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>                       //ͷļ
   2          #define uint unsigned int
   3          #define uchar unsigned char
   4          #define RELOAD_COUNT 0xFA         //궨岨ʷֵ
   5          //define RELOAD_COUNT (256-(((11520000/16)/12)/9600)) ҲԻ9600 //256-Ƶ/x16=BRT
   6          /*****************LEDƶӦP0ڵ1˿*************/
   7          sbit LED0=P3^2;
   8          /************ʷعܼĴĶ****************/
   9          sfr AUXR=0x8E;
  10          sfr BRT=0x9C;
  11          sfr AUXR1=0xA2;
  12          /*****************ر**************/
  13          uchar Receive,i;                             
  14          uint n;
  15          uchar Recive_table[15];        //ڽwifiģ鷴MCUϵ
  16          /*******************************************************************
  17          ƣʱ
  18          ã뼶ʱ΢ʱΪշȴ.......
  19          ********************************************************************/
  20          void ms_delay(uint t)
  21          {
  22   1            uint i,j;
  23   1            for(i=t;i>0;i--)
  24   1             for(j=110;j>0;j--);
  25   1      }
  26          
  27          void us_delay(uchar t)
  28          {
  29   1            while(t--);
  30   1      }
  31          
  32          
  33          
  34          
  35          
  36          
  37          
  38          /********************************************************************
  39          ƣʷ
  40          ãʷT1ʱʵ֣ҲMCUڲĲʷ
  41          ԲֵͬʽݼĴο㣬ʵ
  42          첽ͨѶԣ÷ʽãѡһ֡
  43          ********************************************************************/
  44          void Uart_Init()//ʹöʱ1ΪʷSTC89C52STC89C51AT89C51STC12C560S2Ⱦɣ
  45          {
  46   1            SCON=0x50;     //ΪпԷʽ18λ첽ͨѶ,жϡ
  47   1            //һ֡ϢΪ10λ1λʼλ8λλλȣ1λֹͣλ
  48   1            PCON=0x80;     //SMODѡλΪ1SMOD=1.
  49   1            TMOD=0x21;     //öʱ1Ϊʷģʽ28λԶװ
  50   1            TH1=RELOAD_COUNT;//9600 TH1=256-FOSC/16/12/
  51   1            TL1=TH1;
  52   1            EA=1;                            //жϴ
  53   1            ES=0;                             //رմж
  54   1            TR1=1;                     //ʱ1
C51 COMPILER V9.56.0.0   MAIN                                                              07/26/2017 22:18:44 PAGE 2   

  55   1      }
  56          /*
  57          void Uart_Init()//ʹöĲʷSTC12C560S2жʷ////ĵƬɣ
  58          {
  59                SCON=0x50;     //ΪпԷʽ18λ첽ͨѶ,жϡ
  60                PCON=0x80;     //SMODѡλΪ1SMOD=1.
  61                BRT=RELOAD_COUNT;//9600 256-Ƶ/x16=BRT
  62                AUXR=0xD5;     //T0T112Ƶٶ89C5112//ÿʱӼһ
  63          //ô1ĲʷΪʷ,
  64                AUXR1=0x80;    //лP1
  65                ES=1;         //ж
  66                EA=1;         //ж
  67          }
  68          */
  69          
  70          
  71          
  72          
  73          
  74          
  75          
  76          
  77          /********************************************************************
  78          ƣڷͺ
  79          ܣMCUӵ豸ݣ˴WIFIģESP8266)
  80          ********************************************************************/
  81          void Send_Uart(uchar value)
  82          {
  83   1            ES=0;         //رմж
  84   1            TI=0;         //巢ж־λ
  85   1            SBUF=value;     //
  86   1            while(TI==0);   //ȴ
  87   1            TI=0;         //巢ж־λ
  88   1            ES=1;         //ж
  89   1      }
  90          /********************************************************************
  91          ƣWIFIģú
  92          : ģ飬Աʵ߽Ϳ
  93          ********************************************************************/
  94          void ESP8266_Set(uchar *puf) // ָ*pufַָ               
  95          {
  96   1      
  97   1            while(*puf!='\0')    //ոѭ
  98   1            {
  99   2                 Send_Uart(*puf);  //WIFIģ鷢Ϳָ
 100   2                 us_delay(5);
 101   2                 puf++;      
 102   2            }
 103   1            us_delay(5);
 104   1            Send_Uart('\r');//س
 105   1            us_delay(5);
 106   1            Send_Uart('\n');   //
 107   1            ms_delay(1000);
 108   1      }   
 109          /****************************************************
 110          ƣESP8266ݺ
 111          ܣwifiģն˷
 112          *****************************************************/
 113          void ESP8266_Sent(uchar *puf)      // ָ*pufַָ               
 114          {
 115   1            ESP8266_Set("AT+CIPSEND=0,4");
 116   1            while(*puf!='\0')    //ոѭ
C51 COMPILER V9.56.0.0   MAIN                                                              07/26/2017 22:18:44 PAGE 3   

 117   1            {
 118   2                 Send_Uart(*puf);   //WIFIģ鷢Ϳָ
 119   2                 us_delay(5);
 120   2                 puf++;      
 121   2            }
 122   1            us_delay(5);
 123   1            Send_Uart('\n');   //
 124   1            ms_delay(10);
 125   1      }   
 126          
 127          /********************************************************************
 128          ƣ
 129          ãִ
 130          ********************************************************************/
 131          void main()
 132          {
 133   1            LED0=0;//رLED
 134   1            Uart_Init();//ʹöĲʷ
 135   1      ESP8266_Set("AT+CWMODE=2"); //·ģʽ 1 stationģʽ 2 AP
 136   1      // ·ģʽ 3 station+APģʽ
 137   1            ESP8266_Set("AT+RST");     //wifiģ
 138   1                ESP8266_Set("AT+CWSAP=\"WIFI\",\"1234567890\",11,4");
 139   1      //ģSSID:WIFI, PWD: ȫͼģʽWPA2-PSK
 140   1      ESP8266_Set("AT+CIPMUX=1");//ģʽͻ˽
 141   1      ESP8266_Set("AT+CIPSERVER=1,5000");  //TCP/IP ˿Ϊ8080 ʵֻ//
 142   1            ES=1;                                                           //ж
 143   1            while(1)
 144   1            {         
 145   2      if((Recive_table[0]=='+')&&(Recive_table[1]=='I')&&(Recive_table[2]=='P'))//MCUյΪ+IPDʱж
             -Ͽ0\1ʹС
 146   2                  {
 147   3                      if((Recive_table[3]=='D')&&(Recive_table[6]==','))
 148   3                           {   
 149   4                            if(Recive_table[9]=='0')
 150   4                                  {
 151   5                                        LED0=0;//0                
 152   5      ESP8266_Sent("");
 153   5      //wifiģpc˻ֻ "
 154   5      }
 155   4      
 156   4                                 else if (Recive_table[9]=='1')
 157   4                                  {                                
 158   5                                        LED0=1;    //1 
 159   5                                       ESP8266_Sent("");     
 160   5      //wifiģpc˻ֻ ""            
 161   5                       }
 162   4                 }   
 163   3              }      
 164   2      }         
 165   1      }
 166          
 167          /*********************************************************************
 168          ƣͨѶж
 169          ãͻսúӦı־λ0ʵģ
 170                   շ
 171          ********************************************************************/
 172          void Uart_Interrupt() interrupt 4        
 173          {
 174   1        static uchar i=0;
 175   1            if(RI==1)
 176   1            {
 177   2                 RI=0;
C51 COMPILER V9.56.0.0   MAIN                                                              07/26/2017 22:18:44 PAGE 4   

 178   2                 Receive=SBUF;        //MCUwifiģ鷴
 179   2                 Recive_table[i]=Receive;     
 180   2                 i++;         
 181   2                 if((Recive_table[i-1]=='\n'))i=0;  // װֵ
 182   2      }
 183   1            else TI=0;        
 184   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    330    ----
   CONSTANT SIZE    =    110    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     20       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
